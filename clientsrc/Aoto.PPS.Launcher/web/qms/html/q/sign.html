<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link type="text/css" rel="stylesheet" href="../../../pps/css/main.css" />
	<link rel="stylesheet" type="text/css" href="../../../pps/css/smart_wizard_vertical.css" />
	<link rel="stylesheet" href="../../css/css/style.css">
	<style>
		.site{ 	
			display:table;
			border:0px #95B8E7 solid;top: 50%; 
			background-size:100% 100%;margin: 0; 
			-moz-box-shadow:3px 3px 9px #333;
			-webkit-box-shadow:3px 3px 9px #333;
			box-shadow:3px 3px 9px #333;
			position: absolute;
			text-align:center;
		}
		site:hover{
			border: 0px #fff solid;
			box-shadow: 3px 3px 3px #333;
			margin-left:0px;
			margin-top:0px;
		}
		.site a { 
			display:table-cell;
			border:0px #95B8E7 solid;
		}		
	</style>
</head>
<body  style="margin:0;padding:0;-moz-user-select:none;">
	<div id="main" style="margin:0px auto;position:relative;width:1024px;height:1280px;background-size: 100% 100%;float: left;padding: 0px;background-image: url(../../images/background/11.jpg);">
			<div id="message" style="position: absolute; left: 0px; top: 500px;text-align:center;width:100%;color:#ffffff;font-size: 24px;display:none;">
				<li style="display:block;font-size: 60px;line-height:100px;" id="error"><label style="display:block;cursor: default;"></label><label style="display:block;font-size: 40px;cursor: default;"></label></li>
				<li style="display:block;line-height:40px;" id="zzqd">正在签到...</li>
				<li style="display:block;line-height:40px;" >签到<span style="display:inline-block;width:80px;font-size: 40px;" id="signNum">1</span>次</li>
				<li style="display:block;line-height:40px;">距离上次签到时间<span style="color:#117677;width:100px;display:inline-block;font-size: 40px;" id="signTime">0</span>秒!</li>
			</div>
			
			<div class="site" name = "login" id="login" style="display:none;text-align: center;position: absolute; border: 0px solid #ffffff;background-size: 100% 100%; left: 200px; top: 150px; width: 600px; height: auto; z-index: 999; border-radius:16px;box-shadow: none; transform: skew(0deg, 0deg) rotateZ(0deg);font-size:40px;font-weight:bold;font-family: Microsoft YaHei; background-color: rgba(218, 231, 242, 1); overflow: hidden;padding-top:50px;padding-bottom:50px;">
				<li style="display:block;margin:0;padding:0;">密码键盘</li>
				<li id="loginError" style="display:inline-block;margin-top:20px;box-shadow:0 0 3px 3px rgba(235,190,240,0.6);border-radius:16px;background-size: 100% 100%;width:80%; vertical-align: middle;font-size: 40px;text-align:center; background-color:rgba(194,231,240,1); color: #000000;padding:40px;">
					<label style="display:block;text-align:left;font-size: 30px;"></label>
					<label style="display:block;text-align:left;font-size: 26px;"></label>
				</li>
				<li style="display:block;margin:0;padding:0;margin-top:20px;"><input id="password" type="password" maxlength="11" style="font-weight:bold;margin:0px 1px 8px 1px;width:450px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:rgba(194,231,240,1);"/></li>
				<li style="display:block;margin:0;padding:0;margin-top:20px;" name="keys">
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="1"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="2"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="3"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="4"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="5"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="6"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="7"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="8"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="9"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="清除"/>
					<input type="button" onclick="loginCal(this);" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="0"/>
					<input type="button" onclick="login();" style="font-weight:bold;margin:0px 1px 8px 1px;width:150px;height:80px;border-radius:8px;background-size: 100% 100%;background-color:#4875f7;" value="确认"/>
				</li>
				<li onclick="closeLogin(this);" style="border-radius:8px;display:inline-block;width:50%;text-align:center;background-color:rgba(122,175,59,1);padding:20px;font-size:30px;margin-top:30px;" >
					<label style="display:block;text-align:center;">返&nbsp;&nbsp;&nbsp;&nbsp;回<span style="display:inline-block;width:50px;color:#4875f7" id="keyboardTimeout">30</span></label>
					<label style="display:none;text-align:center;">Return</label>
				</li>
			</div>	
			<div name="blockUI" style="display:none;position: absolute; top: 0%; left: 0%; width: 100%; height: 100%; background-color: black; z-index:11; -moz-opacity: 0.7; opacity:.70; filter: alpha(opacity=70);overflow:hidden;">
			</div>
			
		<div id="loading" style="display:block;position: absolute; top: 0%; left: 0%; width: 100%; height: 100%; background-color: black; z-index:1001; -moz-opacity: 0.7; opacity:.70; filter: alpha(opacity=70);overflow:hidden;">
			<div class ="site" name="loading" style="position:absolute;z-index:1001;text-align:center;background-size: 100% 100%; left:10%; top: 40%; width: 80%; height: auto;box-shadow: none; transform: skew(0deg, 0deg) rotateZ(0deg); font-family: Microsoft YaHei; background-color: rgba(218, 231, 242, 0); overflow: hidden;">
				<li style="background-size: 100% 100%; vertical-align: middle;display:inline-block;width:152px;height:152px;text-align:center;background-image: url(../../images/q/1/dd.gif);font-size:50px;color:#ffffff;" >
				</li>
				<li style="margin-top:50px;vertical-align: middle;display:inline-block;text-align:center;background-color:rgba(122,175,59,0);font-size:50px;color:#ffffff;" >
					<label style="display:block;text-align:center;">正在处理中,请稍候......</label>
					<label style="display:block;text-align:center;">Queuing parameters are being obtained. Please wait…</label>
				</li>	
			</div>	
		</div>	
		<div id="forLogin" style="display:block;  center 0 no-repeat; position: absolute; top: 50px; left: 50px; z-index: 1000; font-size: 24px;">
			<img style="width:auto;height:60px;" src="../../../images/logo.png" alt="" USEMAP="#SystemMap"/>
			<MAP NAME="SystemMap">
				<AREA SHAPE="rect" COORDS="0,0,100,60" onclick="showLogin(1);">
			</MAP>
		</div>
	</div>
 
	<script type="text/javascript" src="../../../js/lib/jquery/jquery.js"></script>
	<script type="text/javascript" src="../../../js/lib/jquery/plugins/jquery.string.js"></script>
	<script type="text/javascript" src="../../../js/lib/jquery/plugins/jquery.json.js"></script>
	<script type="text/javascript" src="../../../js/peripheral.js"></script>
	<script type="text/javascript" src="../../js/validation.js"></script>
	<script type="text/javascript">
		$(document).on("contextmenu", function (e){
			return false;
		});
		$(document).on("selectstart", function (e){
			return false;
		});
		$(document).mousemove(function(e) {
			return false;
		});
		var enFlag = "0";
		var $loading = $("#loading");
		var qmsIp = "";
		var xWidth = screen.width;
		var yHeight = screen.height;
		var $main = $("#main");
		var $biz1 = $("#main");
		var $error = $("#error");
		var $zzqd = $("#zzqd");
		var $signNum = $("#signNum");
		var $signTime = $("#signTime");
		var $message = $("#message");
		var signTimeOut = 10;
		var signIntervalT;
		var keyboardTimeoutIntervalT = null;
		var timeout = 30;
		var keyboardTimeout = 30;
		var adminStr = "";
		var signNum = 0;

		$(function (){
		   qmsIp = $.qms.getCache("qmsIp");
		   screenResolutionCss();
		   initLoadingDiv();
		   hideLoading();
		   sign();
		});
		
		function initLoadingDiv(){
			$loading.empty().html("");
			var $spn = $('<div class ="site" name="loading" style="position:absolute;z-index:1001;text-align:center;background-size: 100% 100%; left:10%; top: 40%; width: 80%; height: auto;box-shadow: none; transform: skew(0deg, 0deg) rotateZ(0deg); font-family: Microsoft YaHei; background-color: rgba(218, 231, 242, 0); overflow: hidden;">'
						+'<li style="background-size: 100% 100%; vertical-align: middle;display:block;width:152px;height:152px;text-align:center;margin:0 auto;background-image: url(../../images/q/1/dd.gif);font-size:50px;color:#ffffff;" >'
						+'</li>'
						+'<li id="loadingMessage" style="margin:0 auto;margin-top:50px;vertical-align: middle;display:inline-block;text-align:center;background-color:rgba(122,175,59,0);font-size:50px;color:#ffffff;" >'
							+'<label style="display:block;text-align:center;">正在处理中,请稍候......</label>'
							+'<label style="display:'+(enFlag=='1'? 'block':'none')+';text-align:center;">Queuing parameters are being obtained. Please wait…</label>'
						+'</li>'	
					+'</div>');
			$spn.appendTo($loading);	
		}
		
		// 竖屏  1024x1280   横屏  1366x768
		function getZoomJo(){
			var args = {};
			//横屏
			//if(screen.width>screen.height){
			//	args.zoomX = screen.width/1366;
			//	args.zoomY = screen.height/768;
			//	args.width = 1366;
			//	args.height = 768;
			//竖屏	
			//}else{
				//使用1024x1280
				//alert(screen.width+"  "+screen.height);
				args.zoomX = screen.width/1024;
				args.zoomY = screen.height/1280;
				args.width = 1024;
				args.height = 1280;
			//}
			return args;
		}
		
		function sign(){
			signNum ++;
			var args = {};
			args.biom = {};
			args.biom.head = {};
			args.biom.head.tradeCode = "qmssign";
			args.biom.head.qmsIp = qmsIp;
			$.qms.qmsSign(args);
		}
		
		//超时自动返回
		function timing(){
			signTimeOut -= 1;
			$signTime.text(signTimeOut);
			if (signTimeOut < 1){
				//alert("重复签到了");
				signTimeOut = 10;
				$zzqd.text("正在重复签到...");
				$signNum.text(signNum+1);
				sign();
			}
			
		}
		
		function qmsSignCallback(jsonString){
			//return; 
			//alert(jsonString);
			var rtn = $.parseJSON(jsonString);
			
			if(rtn.biom.head.retCode == 0){
				//缓存签到信息到cache中
				$.qms.setCache("sign",jsonString);
				$.qms.setCache("signFlag","1");
				//跳转到首页
				window.location.href = "q1.html";
			}else{
				$message.show();
				var retMsg = rtn.biom.head.retMsg;
				var retMsgArr = retMsg.split("|");
				var cnRetMsg = retMsgArr[0];
				var enRetMsg = retMsgArr.length>1 ? retMsgArr[1]:"";
				$error.find("label").eq(0).text(cnRetMsg);
				$error.find("label").eq(1).text(enRetMsg);
				clearInterval(signIntervalT);
				$zzqd.text("");
				signIntervalT = setInterval(function (){
					timing();
				}, 1000);
			}
			
		}
		
		function screenResolutionCss(){
			//xWidth = 1024;
			//yHeight = 1280;
			var args = getZoomJo();
			//alert($.toJSON(args));
			$main.css("transform-origin","0 0");
			$main.css("transform","scale("+args.zoomX+","+args.zoomY+")");
			xWidth = args.width;
			yHeight = args.height;
			$loading.css({"width":xWidth,"height":yHeight});
		}	

		function showLoading(cnRetMsg,enRetMsg){
			if(cnRetMsg){
				$("#loadingMessage").find("label").eq(0).text(cnRetMsg);
				$("#loadingMessage").find("label").eq(1).text(enRetMsg);
			}else{
				$("#loadingMessage").find("label").eq(0).text("正在处理中,请稍候......");
				$("#loadingMessage").find("label").eq(1).text("Queuing parameters are being obtained. Please wait…");
			}
			$loading.show();
		}
		function showLoadingCallback(jsonString){
			var cnRetMsg = "正在处理中,请稍候......";
			var enRetMsg = "Queuing parameters are being obtained. Please wait…"; 	
			if(jsonString){
				var rtn = $.parseJSON(jsonString);
				var retCode = rtn.biom.head.retCode;
				var retMsg = rtn.biom.head.retMsg;
				if(retCode==0&&retMsg){
					var retMsgArr = retMsg.split("|");
					cnRetMsg = retMsgArr[0];
					enRetMsg = retMsgArr.length>1 ? retMsgArr[1]:"";
				}
			}
			showLoading(cnRetMsg,enRetMsg);
		}

		function hideLoading(){
			$loading.hide();
		}

		function hideLoadingCallback(){
			$loading.hide();
		}	

		function showLoginError(cnRetMsg,enRetMsg){
			$("#loginError").show();
			$("#loginError").find("label").eq(0).text(cnRetMsg);
			$("#loginError").find("label").eq(1).text(enRetMsg);
		}

		function hideLoginError(){
			$("#loginError").hide();
			$("#loginError").find("label").eq(0).text("");
			$("#loginError").find("label").eq(1).text("");
		}

		function login(password){
			var password = $("#password").val();
			if (0 == $.trim(password).length){
				showLoginError("请输入密码","Please enter your password");
				return;
			}else{
				$("#password").val("");
			}
			showLoading(); //让后台开启
			var jsonString = $.qms.systemCommond($.trim(password));
			if(jsonString){
				var rtn = $.parseJSON(jsonString);
				var retCode = rtn.biom.head.retCode;
				var retMsg = rtn.biom.head.retMsg;
				var retMsgArr = retMsg.split("|");
				var cnRetMsg = retMsgArr[0];
				var enRetMsg = retMsgArr.length>1 ? retMsgArr[1]:"";
				if(enFlag == "0"){
					enRetMsg = "";
				}
				if(27 != retCode){
					/*  
						关机密码	25
						取号界面退出密码	26
						联机脱机切换密码	27
						值守/非值守模式切换密码	28
						取号界面最小化  29
					*/
					//失败
					if (1 == retCode){
						showLoginError(cnRetMsg,enRetMsg);
					//关机密码	25	
					}else if(25 == retCode){
					//取号界面退出密码	26	
					}else if(26 == retCode){	
					//值守/非值守模式切换密码	28	
					}else if(28 == retCode){
						//zszt = $.qms.getCache("dutyStatus");
						//$("#status4").text((zszt== "1" ? "职守":"非职守"));
						showLoginError(cnRetMsg,enRetMsg);
					}else if(29 == retCode){
						closeLogin();
					}
					hideLoading();
				}
			}
			
		}

		function systemCommondCallback(jsonString){
			if(jsonString){
				var rtn = $.parseJSON(jsonString);
				var retCode = rtn.biom.head.retCode;
				var retMsg = rtn.biom.head.retMsg;
				var retMsgArr = retMsg.split("|");
				var cnRetMsg = retMsgArr[0];
				var enRetMsg = retMsgArr.length>1 ? retMsgArr[1]:"";
				if(enFlag == "0"){
					enRetMsg = "";
				}
				showLoginError(cnRetMsg,enRetMsg);
				//失败
				if (1 == retCode){
				//联机脱机切换密码	27	
				}else if(27 == retCode){
					/*lwzt = (lwzt=="1" ? "0":"1");
					
					var flag = disableOfflineGetTicket();
					if(flag) flag = devStatusGetTicket();
					if(flag){
						//setCardStatus("1");  //back() 中已经包含了setCardStatus("1");
						back();
					}else{
						setCardStatus("0");
					}
					
					$("#status3").text((lwzt== "1" ? "联机":"脱机"));*/
				}
				hideLoading();
			}
		}

		function showLogin(i){
			adminStr += i;
			if (adminStr.length < 3)
			{
				return;
			}
			if (adminStr.length > 3)
			{
				adminStr = "";
				return;
			}
			var s = adminStr.substring(adminStr.length - 3);
			if ("111" == s)
			{
				adminStr = "";
				openLogin();
			}
		}

		function openLogin(){
			hideLoginError();
			$biz1.find("div[name='login']").show();
			$biz1.find("div[name='blockUI']").show();
			$("#password").val("");
			//定时器 			
			keyboardTimeout = timeout;
			//$div = $("div[name='biz']:visible");
			$("#keyboardTimeout").text(keyboardTimeout);
			clearInterval(keyboardTimeoutIntervalT);
			keyboardTimeoutIntervalT = setInterval(function (){
				keyboardTimeoutTiming();
			}, 1000);
		}

		function closeLogin(){
			$biz1.find("div[name='login']").hide();
			$biz1.find("div[name='blockUI']").hide();
			adminStr = '';
			keyboardTimeout = timeout;
			clearInterval(keyboardTimeoutIntervalT);
		}

		function loginCal(obj){
			var $lastValue = $(obj).parent().prev().find("input").eq(0);
			var maxlength = $lastValue.attr("maxlength");
			if($(obj).val()=="清除"){
				$lastValue.val("");
				hideLoginError();
			}else{
				if($lastValue.val()==""){
					hideLoginError();
				}
				
				if($lastValue.val().length<maxlength){
					$lastValue.val($lastValue.val()+$(obj).val());
				}
			}
		}
		//login 超时自动关闭
		function keyboardTimeoutTiming(){
			keyboardTimeout -= 1;
			$("#keyboardTimeout").text(keyboardTimeout);
			if (keyboardTimeout < 1){
				closeLogin();
				keyboardTimeout = timeout;
				clearInterval(keyboardTimeoutIntervalT);
			}
		}	

	</script>
</body>
</html>
