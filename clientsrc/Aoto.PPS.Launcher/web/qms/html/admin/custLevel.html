<!DOCTYPE>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Free HTML5 Bootstrap Admin Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
    <meta name="author" content="Muhammad Usman">

    <!-- The styles -->
    <link id="bs-css" href="../../css/bootstrap-11.min.css" rel="stylesheet">
    <link href="../../css/charisma-app.css" rel="stylesheet">
    <link href='../../css/chosen.min.css' rel='stylesheet'>
    <link href='../../css/colorbox.css' rel='stylesheet'>
    <link href='../../css/responsive-tables.css' rel='stylesheet'>
    <link href='../../css/bootstrap-tour.min.css' rel='stylesheet'>
    <link href='../../css/jquery.noty.css' rel='stylesheet'>
    <link href='../../css/noty_theme_default.css' rel='stylesheet'>
    <link href='../../css/elfinder.min.css' rel='stylesheet'>
    <link href='../../css/elfinder.theme.css' rel='stylesheet'>
    <link href='../../css/jquery.iphone.toggle.css' rel='stylesheet'>
    <link href='../../css/uploadify.css' rel='stylesheet'>
    <link href='../../css/animate.min.css' rel='stylesheet'>
    <link rel="stylesheet"  href="../../css/button.css"/>
    <link rel="stylesheet"  href="../../css/commonlist.css"/>    

    <!-- jQuery -->
	<script type="text/javascript" src="../../js/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="../../js/lib/jquery/plugins/jquery.string.js"></script>
	<script type="text/javascript" src="../../js/lib/jquery/plugins/jquery.json.js"></script>
	<script type="text/javascript" src="../../js/lib/easyui/plugins/jquery.draggable.js"></script>
	<script type="text/javascript" src="../../js/lib/easyui/plugins/jquery.parser.js"></script>
    <script type="text/javascript" src="../../../js/peripheral.js"></script>
	<script type="text/javascript" src="../../js/map.js"></script>
 
    <!-- The fav icon -->
    <link rel="shortcut icon" href="../../images/favicon.ico">

</head>

<body>
<div id="loading1">
	<div>
		<image src='../../js/lib/easyui/themes/default/images/loading.gif' />  正在处理，请稍等...
	</div>
</div>
<div class="ch-container" id="container" style="display: none;">
<ul id="myTab" class="nav nav-tabs">
    <li class="active">
        <a href="#home" data-toggle="tab">
        卡BIN星级规则
        </a>
    </li>
    <li><a href="#cardTypeDiv" data-toggle="tab">卡类型星级规则</a></li>
    <li><a href="#longRangeBin" data-toggle="tab">远程卡BIN星级规则</a></li>
</ul>  
<div id="myTabContent" class="tab-content">
<div class="tab-pane fade in active" id="home">	
    <div class="row">
        
        <noscript>
            <div class="alert alert-block col-md-12">
                <h4 class="alert-heading">Warning!</h4>

               <!-- <p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a>
                    enabled to use this site.</p>-->
            </div>
        </noscript>

        <div id="content" class="col-lg-12 col-sm-12">
            <!-- content starts -->

	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well" data-original-title="">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>本地卡BIN星级规则设置</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content">
					<p class="left">
						<a class="btn btn-primary" href="#" id="addBtn">
							<i class="glyphicon glyphicon-plus icon-white"></i>
							添加
						</a>
					</p>						
					<table class="table table-striped table-bordered responsive" id="ccc">
                        <thead>
                        <tr>
							<th style="width:5%;">序号</th>
							<th style="width:35%;">卡BIN</th>
                            <th style="width:30%;">服务星级</th>
                            <th style="width:30%;">操作</th>
                        </tr>
                        </thead>
                        <tbody>						
							
                        </tbody>
                   </table>
                </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->
	
	
    <!-- content ends -->
    </div><!--/#content.col-md-0-->
</div><!--/fluid-row-->

	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="modalTitle" class="modal-title">
             本地卡BIN添加</h4>
          </div>
          <form id="frm" name="frm" method="post" action="">
          <div class="modal-body">
              <table style="width: 100%">
                <tbody>
                  <tr>
                    <td style="text-align: right; width: 20%">
                                         卡BIN<em>* </em>
                    </td>
                    <td>
                      <input  validate="{required:true,num:true}" maxlength="12" class="form-control" name="cardBin" id="cardBin" placeholder="请输入卡BIN">
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: right; width: 20%">
                                            服务星级<em>* </em>
                    </td>
                    <td>
                      <select name="servelevel" id="servelevel" validate="{required:false}"  >
                      	<option value="0" selected="selected">零星</option>
                      	<option value="3">三星</option>
                      	<option value="4">四星</option>
                      	<option value="5">五星</option>
                      	<option value="6">六星</option>
                      	<option value="7">七星</option>
                      </select>
                    </td>
                  </tr>
                </tbody>
              </table>
          </div>
          <div class="modal-footer">
            <input type="hidden" id="actionType" />
            <input type="button" class="btn btn-default" data-dismiss="modal" value="取消">
            <input type="submit" class="btn btn-primary" value="确定">
          </div>
          </form>
        </div>
      </div>
    </div>

    <footer class="row">
    </footer>

</div>
<div class="tab-pane fade" id="cardTypeDiv" >
    <div class="row">
        
        <noscript>
            <div class="alert alert-block col-md-12">
                <h4 class="alert-heading">Warning!</h4>

               <!-- <p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a>
                    enabled to use this site.</p>-->
            </div>
        </noscript>

        <div id="content" class="col-lg-12 col-sm-12">
            <!-- content starts -->

	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well" data-original-title="">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>本地卡类型星级规则设置</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content">
					<p class="left">
						<a class="btn btn-primary" href="#" id="addBtn1">
							<i class="glyphicon glyphicon-plus icon-white"></i>
							添加
						</a>
					</p>						
					<table class="table table-striped table-bordered responsive" id="ddd">
                        <thead>
                        <tr>
							<th style="width:5%;">序号</th>
							<th style="width:35%;">卡类型</th>
                            <th style="width:30%;">服务星级</th>
                            <th style="width:30%;">操作</th>
                        </tr>
                        </thead>
                        <tbody>						
							
                        </tbody>
                   </table>
                </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->
	
	
    <!-- content ends -->
    </div><!--/#content.col-md-0-->
</div><!--/fluid-row-->

	<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 id="modalTitle1" class="modal-title">
             本地卡类型添加</h4>
          </div>
          <form id="frm1" name="frm1" method="post" action="">
          <div class="modal-body">
              <table style="width: 100%">
                <tbody>
                  <tr>
                    <td style="text-align: right; width: 20%">
                                         卡类型<em>* </em>
                    </td>
                    <td>
                      <select name="cardType" id="cardType" validate="{required:false}" >
                      	<option value="1" selected="selected">准贷记卡</option>
                      	<option value="3">灵通卡</option>
                      	<option value="7">贷记卡</option>
                      	<option value="8">国际卡</option>
                      	<option value="10">牡丹客户卡</option>
                      	<option value="11">理财金/E时代</option>
                      	<option value="14">智富通卡</option>
                      	<option value="15">预付卡</option>
                      	<option value="80">银联卡</option>
                      	<option value="89">海外借记卡</option>
                      </select>                    	
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: right; width: 20%">
                                            服务星级<em>* </em>
                    </td>
                    <td>
                      <select name="servelevel1" id="servelevel1" validate="{required:false}" >
                      	<option value="0" selected="selected">零星</option>
                      	<option value="3">三星</option>
                      	<option value="4">四星</option>
                      	<option value="5">五星</option>
                      	<option value="6">六星</option>
                      	<option value="7">七星</option>
                      </select>
                    </td>
                  </tr>
                </tbody>
              </table>
          </div>
          <div class="modal-footer">
            <input type="hidden" id="actionType1" />
            <input type="button" class="btn btn-default" data-dismiss="modal" value="取消">
            <input type="submit" class="btn btn-primary" value="确定">
          </div>
          </form>
        </div>
      </div>
    </div>

    <footer class="row">
    </footer>

</div>
<div class="tab-pane fade" id="longRangeBin">
	<div class="row">
        
        <noscript>
            <div class="alert alert-block col-md-12">
                <h4 class="alert-heading">Warning!</h4>

               <!-- <p>You need to have <a href="http://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a>
                    enabled to use this site.</p>-->
            </div>
        </noscript>

        <div id="content" class="col-lg-12 col-sm-12">
            <!-- content starts -->

	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well" data-original-title="">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>远程卡BIN星级规则设置</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content queue-adjust">						
					<table class="table table-striped table-bordered responsive" id="yyy">
                        <thead>
                        <tr>
							<th style="width:5%;">序号</th>
							<th style="width:40%;">卡BIN</th>
                            <th style="width:35%;">服务星级</th>
                        </tr>
                        </thead>
                        <tbody>						
							
                        </tbody>
                   </table>
                </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->
	
	
    <!-- content ends -->
    </div><!--/#content.col-md-0-->
</div><!--/fluid-row-->
</div>
</div>
</div><!--/.fluid-container-->
<!-- external javascript -->

<script src="../../js/bootstrap.min.js"></script>

<!-- library for cookie management -->
<script src="../../js/jquery.cookie.js"></script>
<!-- data table plugin -->
<script src='../../js/jquery.dataTables.min.js'></script>

<!-- select or dropdown enhancer -->
<script src="../../js/chosen.jquery.min.js"></script>
<!-- plugin for gallery image view -->
<script src="../../js/jquery.colorbox-min.js"></script>
<!-- notification plugin -->
<script src="../../js/jquery.noty.js"></script>
<!-- library for making tables responsive -->
<script src="../../js/responsive-tables.js"></script>
<!-- tour plugin -->
<script src="../../js/bootstrap-tour.min.js"></script>
<!-- star rating plugin -->
<script src="../../js/jquery.raty.min.js"></script>
<!-- for iOS style toggle switch -->
<script src="../../js/jquery.iphone.toggle.js"></script>
<!-- autogrowing textarea plugin -->
<script src="../../js/jquery.autogrow-textarea.js"></script>
<!-- multiple file upload plugin -->
<script src="../../js/jquery.uploadify-3.1.min.js"></script>
<!-- history.js for cross-browser state change on ajax -->
<script src="../../js/jquery.history.js"></script>
<!-- application script for Charisma demo -->
<script src="../../js/charisma.js"></script>
<script type="text/javascript" src="../../js/jquery.metadata.js"></script>
<script type="text/javascript" src="../../js/jquery.validate.js"></script>
<script type="text/javascript" src="../../js/qmsVld.js"></script>
<script type="text/javascript" src="../../js/bootbox.js"></script>

<script type="text/javascript">
	var $rowNum = 0;	
    var $myModal = $("#myModal");
    var $actionType = $("#actionType");
    var $modalTitle = $("#modalTitle");	
    
    var $rowNum1 = 0;
    var $myModal1 = $("#myModal1");
    var $actionType1 = $("#actionType1");
    var $modalTitle1 = $("#modalTitle1");	
    
    var $rowNum2 = 0;
	$(function (){	
		$.metadata.setType("attr", "validate");
		$("#frm").validate({
			onfocusout: function(element) { 
				$(element).valid(); 
			},
			submitHandler: function(form){
				saveConfig();
				return false;
			}
		});
		
		$("#frm1").validate({
			onfocusout: function(element) { 
				$(element).valid(); 
			},
			submitHandler: function(form){
				saveConfig1();
				return false;
			}
		});		
		
		$("#addBtn").on("click", function(e){
	        e.preventDefault();
	        var itemData = {};
	        showModal("new", itemData);
		});	
		
		$("#addBtn1").on("click", function(e){
	        e.preventDefault();
	        var itemData = {};
	        showModal1("new", itemData);
		});			
		initPage();
		setTimeout(function(){
			initPage1();
		},1000);
		setTimeout(function(){
			initPage2();
		},2000);
	});
	
	
    function editTr(obj)
    {
      //window.event.stopPropagation();
      var $tr = $(obj).parent().parent();
      showModal("update", $tr.data("itemData"));
    }
    
    function editTr1(obj)
    {
      //window.event.stopPropagation();
      var $tr = $(obj).parent().parent();
      showModal1("update", $tr.data("itemData"));
    }    
	

	//-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    function initPage()
    {
      $('#myModal').modal('hide');
      $rowNum = 0;
      $("#ccc tbody").empty().html("");    	

	  var args = {};
	  args.biom = {};
	  args.biom.head = {};
	  args.biom.head.tradeCode = "localcardbin2select";
	  args.biom.head.qmsIp = $.qms.getCache("qmsIp");
	  args.biom.body = {};	
	  args.command=34;	
	  args.callback="getLocalcardbinCallBack";
	  $.icbcQms.localcardbin2JS(args);
	}
    
    function initPage1()
    {
      $('#myModal1').modal('hide');
      $rowNum1 = 0;
      $("#ddd tbody").empty().html("");    	

	  var args = {};
	  args.biom = {};
	  args.biom.head = {};
	  args.biom.head.tradeCode = "localcardtype2select";
	  args.biom.head.qmsIp = $.qms.getCache("qmsIp");
	  args.biom.body = {};	
	  args.command=34;
	  //alert($.toJSON(args));
	  args.callback="getLocalcardtypeCallBack";
	  $.icbcQms.localcardtype2JS(args);
	}
    
    function initPage2(){
    	$("#yyy tbody").empty().html("");
    	$rowNum2 = 0;
    	var args = {};
    	args.biom = {};
    	args.biom.head ={};
    	args.biom.head.tradeCode = "biomqmscardbin";
    	args.biom.body = {};
    	args.biom.body.qmsIp = $.qms.getCache("qmsIp");
		args.command=34;
		//alert($.toJSON(args));
		args.callback="biomqmscardbinselectCallBack";
		$.icbcQms.biomcardbin2JS(args);
    }
    
    //初始化远程卡BIN callback
    function biomqmscardbinselectCallBack(args){
    	closeLoading();
	    //var joStr = "{\"biom\":{\"head\":{\"retCode\":\"0\",\"retMsg\":\"成功\"},\"body\":{\"carList\":{\"carRecord\":[{\"cardBin\":\"钻石卡客户\",\"servelevel\":\"4\"},{\"cardBin\":\"白金卡\",\"servelevel\":\"7\"}]}}}}";
	    //alert(joStr);
	    $("#container").css("display","block");
	    var jo = $.parseJSON(args);    	
		var retCode = jo.biom.head.retCode;
		var retMsg = jo.biom.head.retMsg;		
		if(retCode == "0"){				
			$.each(jo.biom.body.carList.carRecord, function (index, item){
				initData2(item);
			});		
		}else{
			//跳转错误页面
			//window.location.href = "timeout.html?retMsg="+retMsg;
			$("#yyy").hide();
			var retMsgChinese = retMsg.split("|");
			$("<div style=\"text-align: center;height: 40%;font-size:25px;\">"+"<div style='margin:35% auto 0px auto;'>"+retMsgChinese[0]+"</div>"+"</div>").appendTo($(".queue-adjust"));
		} 
    }
    
    //初始化卡BIN callback
    function getLocalcardbinCallBack(args){
    	closeLoading();
    	//alert(args);
	    //var joStr = "{\"biom\":{\"head\":{\"retCode\":\"0\",\"retMsg\":\"成功\"},\"body\":{\"carList\":{\"carRecord\":[{\"cardBin\":\"钻石卡客户\",\"servelevel\":\"4\"},{\"cardBin\":\"白金卡\",\"servelevel\":\"7\"}]}}}}";
	    //alert(joStr);
	    $("#container").css("display","block");
	    var jo = $.parseJSON(args);    	
		var retCode = jo.biom.head.retCode;
		var retMsg = jo.biom.head.retMsg;		
		if(retCode == "0"){				
			$.each(jo.biom.body.carList.carRecord, function (index, item){
				initData(item);
			});		
		}else{
			//跳转错误页面
			window.location.href = "timeout.html?retMsg="+retMsg;		
		}    	
    }
    
    //初始化卡类型 callback
    function getLocalcardtypeCallBack(args){
    	//alert($.toJSON(args));
     	closeLoading();
	    var jo = $.parseJSON(args);    	
		var retCode = jo.biom.head.retCode;
		var retMsg = jo.biom.head.retMsg;		
		if(retCode == "0"){				
			$.each(jo.biom.body.carList.carRecord, function (index, item){
				initData1(item);
				//item.car
			});		
		}else{
			//跳转错误页面
			window.location.href = "timeout.html?retMsg="+retMsg;		
		}   	
    }
    
    //增 卡BIN callback
    function addLocalcardbinCallBack(args)
    {
		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage();
			}else{
			  qmsVld.showError(retMsg?retMsg:"新增卡BIN星级失败");
			}				
		}    	
	  
    }
    
    //增 卡类型  callback
    function addLocalcardtypeCallBack(args){
 		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage1();
			}else{
			  qmsVld.showError(retMsg?retMsg:"新增卡类型星级失败");
			}				
		}     	
    }
	
	//改 卡BIN callback
	function updateLocalcardbinCallBack(args)
    {
		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage();
			}else{
			  qmsVld.showError(retMsg?retMsg:"修改卡BIN星级失败");
			}				
		}   
	  
    }
    
    //改 卡类型 callback
    function updateLocalcardtypeCallBack(args){
 		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage1();
			}else{
			  qmsVld.showError(retMsg?retMsg:"修改卡类型星级失败");
			}				
		}   	
    }
	
	//删 卡BIN callback
	function removeLocalcardbinCallBack(args)
    {
		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage();
			}else{
			  qmsVld.showError(retMsg?retMsg:"删除卡BIN星级失败");
			}				
		}  
    }   
    
    //删 卡类型 callback
    function removeLocalcardtypeCallBack(args){
 		var joResult = $.parseJSON(args);
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(joResult){
			if(retCode == 0){
			  qmsVld.showInfo(retMsg);
			  initPage1();
			}else{
			  qmsVld.showError(retMsg?retMsg:"删除卡类型星级失败");
			}				
		}   	
    }
    
    
	function delTr(obj){
//		window.event.stopPropagation();
		bootbox.setLocale("zh_CN");
      	bootbox.confirm("确定删除?", function(result) {
	        if (result) {  
		    	var $tr = $(obj).parent().parent();
		        var args = {};
				args.biom = {};
				args.biom.head = {};
				args.biom.head.tradeCode = "localcardbin2delete";
				args.biom.head.qmsIp = $.qms.getCache("qmsIp");
				args.biom.body = {};
				args.biom.body.cardBin = $tr.data("itemData").cardBin;
				args.biom.body.servelevel = $tr.data("itemData").servelevel;
		        args.callback="removeLocalcardbinCallBack";	
				args.command=32;			
		        $.icbcQms.localcardbin2JS(args); 
	        }  
      	});
	}   
	
	function delTr1(obj){
//		window.event.stopPropagation();
		bootbox.setLocale("zh_CN");
      	bootbox.confirm("确定删除?", function(result) {
	        if (result) {  
				var $tr = $(obj).parent().parent();
		        var args = {};
				args.biom = {};
				args.biom.head = {};
				args.biom.head.tradeCode = "localcardtype2delete";
				args.biom.head.qmsIp = $.qms.getCache("qmsIp");
				args.biom.body = {};
				args.biom.body.cardType = $tr.data("itemData").cardType;
				args.biom.body.servelevel = $tr.data("itemData").servelevel;
		        args.callback="removeLocalcardtypeCallBack";	
				args.command=32;			
		        $.icbcQms.localcardtype2JS(args);  	
	        }  
      	});
	} 	
	
	//初始化列表数据
	function initData(itemData)
	{
		//取到最大序号+1
		var $tbody = $("#ccc tbody");
		if($tbody.find("tr:last")){
			var num = $tbody.find("tr:last").find("td").eq(0).text();
			if(num){
				$rowNum = num;
			}
		}
		
		$rowNum++;
		var $tr;

		if(itemData){		
			$tr = $("<tr>"+
				"<td>"+$rowNum+"</td>"+
				"<td><div class=\"controls\">"+itemData.cardBin+"</div></td>"+
				"<td><div class=\"controls\">"+init_servelevel(itemData.servelevel)+"</div></td>"+
//              "<td class=\"center\"><a class='btn btn-primary btn-custom' href='#' name='editTmpBtn' onclick='editTr(this);'><i class='glyphicon glyphicon-edit icon-white'></i> 编辑</a> " +				
//				"<a class=\"btn btn-primary btn-custom\" href=\"#\" onclick='delTr(this);'><i class=\"glyphicon glyphicon-trash icon-white\"></i>删除</a></td>"+
				"<td><button class=\"btn btn-primary btn-custom\"><i class='glyphicon glyphicon-edit icon-white'></i> 编辑</button>"+
				"<button class=\"btn btn-primary btn-custom\"><i class=\"glyphicon glyphicon-trash icon-white\"></i>删除</button></td>"+
			"</tr>");
		}
		$tr.data("itemData",itemData);
		$tr.appendTo($tbody);
		//$(".iphone-toggle",$tr).iphoneStyle();
		$('[data-rel="chosen"],[rel="chosen"]').chosen();
		
		$tbody.find("button:last").prev().on("click",function(){
			editTr(this);
		});
		$tbody.find("button:last").on("click",function(){
			delTr(this);
		});
	}
	
	//初始化列表数据
	function initData1(itemData)
	{
		//取到最大序号+1
		var $tbody = $("#ddd tbody");
		if($tbody.find("tr:last")){
			var num = $tbody.find("tr:last").find("td").eq(0).text();
			if(num){
				$rowNum1 = num;
			}
		}
		
		$rowNum1++;
		var $tr;

		if(itemData){		
			$tr = $("<tr>"+
				"<td>"+$rowNum1+"</td>"+
                "<td><div class=\"controls\">"+init_cardType(itemData.cardType)+"</div></td>"+
				"<td><div class=\"controls\">"+init_servelevel(itemData.servelevel)+"</div></td>"+
//              "<td class=\"center\"><a class='btn btn-primary btn-custom' href='#' name='editTmpBtn' onclick='editTr1(this);'><i class='glyphicon glyphicon-edit icon-white'></i> 编辑</a> " +				
//				"<a class=\"btn btn-primary btn-custom\" href=\"#\" onclick='delTr1(this);'><i class=\"glyphicon glyphicon-trash icon-white\"></i>删除</a></td>"+
				"<td><button class=\"btn btn-primary btn-custom\"><i class='glyphicon glyphicon-edit icon-white'></i> 编辑</button>"+
				"<button class=\"btn btn-primary btn-custom\"><i class=\"glyphicon glyphicon-trash icon-white\"></i>删除</button></td>"+
			"</tr>");
		}
		$tr.data("itemData",itemData);
		$tr.appendTo($tbody);
		//$(".iphone-toggle",$tr).iphoneStyle();
		$('[data-rel="chosen"],[rel="chosen"]').chosen();
		
		$tbody.find("button:last").prev().on("click",function(){
			editTr1(this);
		});
		$tbody.find("button:last").on("click",function(){
			delTr1(this);
		});
	}
	
	function initData2(itemData)
	{
		//取到最大序号+1
		var $tbody = $("#yyy tbody");
		if($tbody.find("tr:last")){
			var num = $tbody.find("tr:last").find("td").eq(0).text();
			if(num){
				$rowNum2 = num;
			}
		};
		$rowNum2++;
		var $tr;

		if(itemData){		
			$tr = $("<tr>"+
				"<td>"+$rowNum2+"</td>"+
				"<td><div class=\"controls\">"+itemData.cardBin+"</div></td>"+
				"<td><div class=\"controls\">"+init_servelevel(itemData.servelevel)+"</div></td>"+
			"</tr>");
		}
		$tr.data("itemData",itemData);
		$tr.appendTo($tbody);
		//$(".iphone-toggle",$tr).iphoneStyle();
		$('[data-rel="chosen"],[rel="chosen"]').chosen();
	}
	
	//保存
	function saveConfig()
	{
        $("#myModal input").parent().removeClass("has-error");
        var type = $actionType.val();
        var args = {};
        if(type=="new"){
			args.biom = {};
			args.biom.head = {};
			args.biom.head.tradeCode = "localcardbin2add";
			args.biom.head.qmsIp = $.qms.getCache("qmsIp");
			args.biom.body = {};
			args.biom.body.cardBin = $("#cardBin").val();
			args.biom.body.servelevel = $("#servelevel").val();		        
	        args.callback="addLocalcardbinCallBack";	
			args.command=31;
        }else if(type=="update"){
			args.biom = {};
			args.biom.head = {};
			args.biom.head.tradeCode = "localcardbin2update";
			args.biom.head.qmsIp = $.qms.getCache("qmsIp");
			args.biom.body = {};
			args.biom.body.cardBin = $("#cardBin").val();
			args.biom.body.servelevel = $("#servelevel").val();	
	        args.callback="updateLocalcardbinCallBack";	
			args.command=33;
        } 
        //alert($.toJSON(args)); 
        $.icbcQms.localcardbin2JS(args);
	}
	
	///卡类型保存
	function saveConfig1()
	{
        $("#myModal1 input").parent().removeClass("has-error");
        var type = $actionType1.val();
        var args = {};
        if(type=="new"){
			args.biom = {};
			args.biom.head = {};
			args.biom.head.tradeCode = "localcardtype2add";
			args.biom.head.qmsIp = $.qms.getCache("qmsIp");
			args.biom.body = {};
			args.biom.body.cardType = $("#cardType").val();
			args.biom.body.servelevel = $("#servelevel1").val();		        
	        args.callback="addLocalcardtypeCallBack";	
			args.command=31;
        }else if(type=="update"){
			args.biom = {};
			args.biom.head = {};
			args.biom.head.tradeCode = "localcardtype2update";
			args.biom.head.qmsIp = $.qms.getCache("qmsIp");
			args.biom.body = {};
			args.biom.body.cardType = $("#cardType").val();
			args.biom.body.servelevel = $("#servelevel1").val();	
	        args.callback="updateLocalcardtypeCallBack";	
			args.command=33;
        } 
        //alert($.toJSON(args)); 
        $.icbcQms.localcardtype2JS(args);
	}	
	

	function init_select_Buz(initValue){
		var joStr = "[{\"levelKey\":\"0\",\"levelName\":\"零星\"},{\"levelKey\":\"3\",\"levelName\":\"三星\"},{\"levelKey\":\"4\",\"levelName\":\"四星\"},{\"levelKey\":\"5\",\"levelName\":\"五星\"},{\"levelKey\":\"6\",\"levelName\":\"六星\"},{\"levelKey\":\"7\",\"levelName\":\"七星\"},{\"levelKey\":\"99\",\"levelName\":\"无星级\"}]";
		//alert(joStr);
		var jo = $.parseJSON(joStr);
		var selectorsBuz = "";	
		$.each(jo, function (index, item){
			if(initValue == item.levelKey){
				selectorsBuz += "<option selected value="+item.levelKey+">"+item.levelName+"</option>";   
			}else{
				selectorsBuz += "<option value="+item.levelKey+">"+item.levelName+"</option>";   
			}
		});
		return selectorsBuz;
	}
	
	function init_servelevel(initValue){
		var joStr = "[{\"levelKey\":\"0\",\"levelName\":\"零星\"},{\"levelKey\":\"3\",\"levelName\":\"三星\"},{\"levelKey\":\"4\",\"levelName\":\"四星\"},{\"levelKey\":\"5\",\"levelName\":\"五星\"},{\"levelKey\":\"6\",\"levelName\":\"六星\"},{\"levelKey\":\"7\",\"levelName\":\"七星\"},{\"levelKey\":\"99\",\"levelName\":\"无星级\"}]";
		//alert(joStr);
		var jo = $.parseJSON(joStr);
		var selectorsBuz = "";	
		$.each(jo, function (index, item){
			if(initValue == item.levelKey){
				selectorsBuz += item.levelName;   
			}
		});
		return selectorsBuz;		
	}
	
	function init_cardType(initValue){
		var joStr = "[{\"typeKey\":\"1\",\"typeName\":\"准贷记卡\"},{\"typeKey\":\"3\",\"typeName\":\"灵通卡\"},{\"typeKey\":\"7\",\"typeName\":\"贷记卡\"},{\"typeKey\":\"8\",\"typeName\":\"国际卡\"},{\"typeKey\":\"10\",\"typeName\":\"牡丹客户卡\"},{\"typeKey\":\"11\",\"typeName\":\"理财金/E时代\"},{\"typeKey\":\"14\",\"typeName\":\"智富通卡\"},{\"typeKey\":\"15\",\"typeName\":\"预付卡\"},{\"typeKey\":\"80\",\"typeName\":\"银联卡\"},{\"typeKey\":\"89\",\"typeName\":\"海外借记卡\"}]";
		//alert(joStr);
		var jo = $.parseJSON(joStr);
		var selectorsBuz = "";	
		$.each(jo, function (index, item){
			if(initValue == item.typeKey){
				selectorsBuz += item.typeName;   
			}
		});
		return selectorsBuz;		
	}
	        	        
	var levelArray = new Array("0","3","4","5","6","7");
	var cardTypeArray = new Array("1","3","7","8","10","11","14","15","80","89");
	function showModal(type, itemData)
    {	
	//      window.event.stopPropagation();
	//      window.event.preventDefault();
	      $("#frm input").popover('hide');
	      $("#frm input").parent().removeClass("has-error");
	      if (type == "new"){
	        $modalTitle.text("本地卡BIN新增");
	        $("#cardBin").val("");
	        $("#cardBin").attr("disabled",false);
//	        $("#servelevel option[value='0']").attr("selected","selected");  
            $("#servelevel").val("0");
			$("#servelevel").trigger("chosen:updated");
			$("#servelevel").chosen(); 
			$("#servelevel").next().css("width","60%");
	      } else if (type == "update"){
	        $modalTitle.text("本地卡BIN修改");
	        $("#cardBin").attr("disabled","disabled");
	        $("#cardBin").val(itemData.cardBin);
	        //alert(jQuery.inArray(itemData.servelevel, levelArray));
	        var flag = jQuery.inArray(itemData.servelevel, levelArray);
	        if(flag == -1){
	        	$("#servelevel").val("0");
	        	//$("#servelevel option[value='0']").attr("selected","selected");
	        }else{
	        	$("#servelevel").val(itemData.servelevel);
	        	//$("#servelevel option[value='"+itemData.servelevel+"']").attr("selected","selected");
	        }	          
			$("#servelevel").trigger("chosen:updated");
			$("#servelevel").chosen(); 
			$("#servelevel").next().css("width","60%");		
	      }
	      $actionType.val(type);
	      $myModal.modal('show');
    }	
    
	function showModal1(type, itemData)
    {	
	//      window.event.stopPropagation();
	//      window.event.preventDefault();
	      $("#frm1 input").popover('hide');
	      $("#frm1 input").parent().removeClass("has-error");
	      //$("#servelevel").empty();
	      if (type == "new"){
	        $modalTitle1.text("本地卡类型新增");
	        $("#cardType").attr("disabled",false)
	        //$("#cardType option[value='1']").attr("selected","selected");  
	        $("#cardType").val("1");
			$("#cardType").trigger("chosen:updated");
			$("#cardType").chosen(); 
			$("#cardType").next().css("width","60%");	        
	        
	        //$("#servelevel1 option[value='0']").attr("selected","selected");  
	        $("#servelevel1").val("0");
			$("#servelevel1").trigger("chosen:updated");
			$("#servelevel1").chosen(); 
			$("#servelevel1").next().css("width","60%");
	      } else if (type == "update"){
	        $modalTitle1.text("本地卡类型修改");
	        $("#cardType").attr("disabled","disabled")
	        var flag1 = jQuery.inArray(itemData.cardType, cardTypeArray);
	        if(flag1 == -1){
	        	//$("#cardType option[value='1']").attr("selected","selected");
	        	$("#cardType").val("1");
	        }else{
	        	//$("#cardType option[value='"+itemData.cardType+"']").attr("selected","selected");
	        	$("#cardType").val(itemData.cardType);
	        }	          
			$("#cardType").trigger("chosen:updated");
			$("#cardType").chosen(); 
			$("#cardType").next().css("width","60%");

	        var flag2 = jQuery.inArray(itemData.servelevel, levelArray);
	        if(flag2 == -1){
	        	$("#servelevel1 option[value='0']").attr("selected","selected");
	        }else{
	        	//$("#servelevel1 option[value='"+itemData.servelevel+"']").attr("selected","selected");
	        	$("#servelevel1").val(itemData.servelevel);
	        }	          
			$("#servelevel1").trigger("chosen:updated");
			$("#servelevel1").chosen(); 
			$("#servelevel1").next().css("width","60%");		
	      }
	      $actionType1.val(type);
	      $myModal1.modal('show');
    }    

</script>

</body>
</html>
