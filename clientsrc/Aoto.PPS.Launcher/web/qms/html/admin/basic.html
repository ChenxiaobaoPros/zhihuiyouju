<!DOCTYPE>
<html lang="en">
<head>
    <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Free HTML5 Bootstrap Admin Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
    <meta name="author" content="Muhammad Usman">

    <!-- The styles -->
    <link href="../../css/bootstrap-11.min.css" rel="stylesheet">
    <link href="../../css/charisma-app.css" rel="stylesheet">
    <link href='../../css/chosen.min.css' rel='stylesheet'>
    <link href='../../css/colorbox.css' rel='stylesheet'>
    <link href='../../css/responsive-tables.css' rel='stylesheet'>
    <link href='../../css/bootstrap-tour.min.css' rel='stylesheet'>
    <link href='../../css/jquery.noty.css' rel='stylesheet'>
    <link href='../../css/noty_theme_default.css' rel='stylesheet'>
    <link href='../../css/elfinder.min.css' rel='stylesheet'>
    <link href='../../css/elfinder.theme.css' rel='stylesheet'>
    <link href='../../css/jquery.iphone.toggle.css' rel='stylesheet'>
    <link href='../../css/uploadify.css' rel='stylesheet'>
    <link href='../../css/animate.min.css' rel='stylesheet'>
    <link href='../../css/bootstrap-datetimepicker.css' rel='stylesheet'>
    <link rel="stylesheet"  href="../../css/icheck/yellow.css"/>
    <link rel="stylesheet"  href="../../css/button.css"/>
    <link rel="stylesheet"  href="../../css/common.css"/>

    <!-- jQuery -->
	<script type="text/javascript" src="../../js/lib/jquery/jquery.min.js"></script>
	<script type="text/javascript" src="../../js/lib/jquery/plugins/jquery.string.js"></script>
	<script type="text/javascript" src="../../js/lib/jquery/plugins/jquery.json.js"></script>
	<script type="text/javascript" src="../../js/lib/easyui/plugins/jquery.draggable.js"></script>
	<script type="text/javascript" src="../../js/lib/easyui/plugins/jquery.parser.js"></script>
    <script type="text/javascript" src="../../../js/peripheral.js"></script>
	<script type="text/javascript" src="../../js/map.js"></script>
	<script src="../../js/lib/jquery/icheck/jquery.icheck.js" type="text/javascript" ></script>
 
    <!-- The fav icon -->
    <link rel="shortcut icon" href="../../images/favicon.ico">
    

</head>

<body>
<div id="loading1">
	<div>
		<image src='../../js/lib/easyui/themes/default/images/loading.gif' />  正在处理，请稍等...
	</div>
</div> 
<div class="ch-container" id="container" style="display: none;">
	<form id= "frm">
    <div class="row" >
        
        <noscript>
            <div class="alert alert-block col-md-12">
                <h4 class="alert-heading">Warning!</h4>
            </div>
        </noscript>

        <div id="content" class="col-lg-12 col-sm-12">
            <!-- content starts -->
	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>营业厅基本信息设置</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content">
                <table class="table table-bordered responsive">
                     
                        <tbody>
							<tr>
								<td  class="td-right">
									<div class="form-label">网点代码<em>* </em></div>
								</td>
								<td>
									<div class="controls">
										<input type="text" id="siteId" name="siteId" class="form-control"  placeholder="请输入网点代码" maxlength="5" />
									</div>
								</td>

							</tr>
							<tr>
								<td  class="td-right">
									地区编号<em>* </em>
								</td>
								<td >
									<div class="controls">
										<input type="text" id="zoneNo" name="zoneNo" class="form-control"  placeholder="请输入地区编号" maxlength="5" />
									</div>
								</td>								
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">网点名称<em>* </em></div>
								</td>
								<td >
									<div class="controls">
										<input type="text" id="siteName" name="siteName" class="form-control"  placeholder="请输入网点名称" maxlength="500" />
									</div>
								</td>
							</tr>							
                        </tbody>
                    </table>
               </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->
    
	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>基本运行参数</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content">
                <table class="table table-bordered responsive">                    
                        <tbody>
							<tr>
								<td class="td-right">
									<div class="form-label">取号终端是否自动关机</div>
								</td>
								<td >
									<div class="controls">
										<input type="checkbox" id="getAutoShutdownFlag" name="getAutoShutdownFlag"/>
									</div>
								</td>							
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">取号终端关机时间</div>
								</td>
								<td >
									<div class="controls">
										<input type="text" id="getShutdownTime" name="getShutdownTime" class="form-control" readonly="readonly"/>
									</div>
								</td>
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">叫号终端是否自动开机</div>
								</td>
								<td >
									<div class="controls">
										<input type="checkbox" id="callAutoSrartonFlag" name="callAutoSrartonFlag" />
									</div>
								</td>							
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">叫号终端开机时间</div>
								</td>
								<td >
									<div class="controls">
										<input type="text" id="startonTime" name="startonTime" class="form-control" readonly="readonly"/>
									</div>
								</td>
							</tr>	
							<tr>
								<td class="td-right">
									<div class="form-label">叫号终端是否自动关机</div>
								</td>
								<td >
									<div class="controls">
										<input type="checkbox" id="callAutoShutdownFlag" name="callAutoShutdownFlag" />
									</div>
								</td>							
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">叫号终端关机时间</div>
								</td>
								<td >
									<div class="controls">
										<input type="text" id="callShutdownTime" name="callShutdownTime" class="form-control" readonly="readonly"/>
									</div>
								</td>
							</tr>
                        </tbody>
                    </table>
               </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->   
    
	<div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-header well">
                    <h2><i class="glyphicon glyphicon-info-sign"></i>管理密码设置</h2>

                    <div class="box-icon">
                        <a href="#" class="btn btn-minimize btn-round btn-default"><i
                                class="glyphicon glyphicon-chevron-up"></i></a>
                    </div>
                </div>
                <div class="box-content">
                <table class="table table-bordered responsive">                    
                        <tbody>
							<tr>
								<td class="td-right">
									<div class="form-label">关机密码<em>* </em></div>
								</td>
								<td >
									<div class="controls">
										<input style="float: left;" type="password" id="shutdownPwd" name="shutdownPwd" class="form-control"  placeholder="请输入关机密码" maxlength="10"/>
										<img class="eye" style="float: left;width: 23px;height: 23px;margin-top:7.5px;position: relative;left: -29px;" src="../../../images/o_eye.png"/>
									</div>
								</td>							
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">取号界面退出密码<em>* </em></div>
								</td>
								<td>
									<div class="controls">
										<input style="float: left;" type="password" id="exitGetTicketPwd" name="exitGetTicketPwd" class="form-control"  placeholder="请输入取号界面退出密码" maxlength="10"/>
										<img class="eye" style="float: left;width: 23px;height: 23px;margin-top:7.5px;position: relative;left: -29px;" src="../../../images/o_eye.png"/>
									</div>
								</td>
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">联机/脱机切换<em>* </em></div>
								</td>
								<td>
									<div class="controls">
										<input style="float: left;" type="password" id="onlineSwitchPwd" name="onlineSwitchPwd" class="form-control"  placeholder="请输入联机/脱机切换密码" maxlength="10"/>
										<img class="eye" style="float: left;width: 23px;height: 23px;margin-top:7.5px;position: relative;left: -29px;" src="../../../images/o_eye.png"/>
									</div>
								</td>							
							</tr>
							<tr>
								<td class="td-right">
									<div class="form-label">值守/非值守切换<em>* </em></div>
								</td>
								<td>
									<div class="controls">
										<input style="float: left;" type="password" id="dutySwitchPwd" name="dutySwitchPwd" class="form-control"  placeholder="请输入值守/非值守切换密码" maxlength="10"/>
										<img class="eye" style="float: left;width: 23px;height: 23px;margin-top:7.5px;position: relative;left: -29px;" src="../../../images/o_eye.png"/>
									</div>
								</td>
							</tr>							
                        </tbody>
                    </table>
               </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->       					
    <!-- content ends -->
    </div><!--/#content.col-md-0-->
</div><!--/fluid-row-->
    <div class="row">
        <div class="box col-md-12">
            <div class="box-inner">
                <div class="box-content">
                	<p class="center" style="margin-bottom: 0px;">
						<input type="submit" class="btn btn-primary btn-custom" id="saveConfig" value="保存">						
					</p>
					
               </div>
            </div>
        </div>
        <!--/span-->
    </div><!--/row-->
</form>
</div><!--/.fluid-container-->

<!-- external javascript -->

<script src="../../js/bootstrap.min.js"></script>

<!-- library for cookie management -->
<script src="../../js/jquery.cookie.js"></script>
<!-- data table plugin -->
<script src='../../js/jquery.dataTables.min.js'></script>

<!-- select or dropdown enhancer -->
<script src="../../js/chosen.jquery.min.js"></script>
<!-- plugin for gallery image view -->
<script src="../../js/jquery.colorbox-min.js"></script>
<!-- notification plugin -->
<script src="../../js/jquery.noty.js"></script>
<!-- library for making tables responsive -->
<script src="../../js/responsive-tables.js"></script>
<!-- tour plugin -->
<script src="../../js/bootstrap-tour.min.js"></script>
<!-- star rating plugin -->
<script src="../../js/jquery.raty.min.js"></script>
<!-- for iOS style toggle switch -->
<script src="../../js/jquery.iphone.toggle.js"></script>
<!-- autogrowing textarea plugin -->
<script src="../../js/jquery.autogrow-textarea.js"></script>
<!-- multiple file upload plugin -->
<script src="../../js/jquery.uploadify-3.1.min.js"></script>
<!-- history.js for cross-browser state change on ajax -->
<script src="../../js/jquery.history.js"></script>
<!-- application script for Charisma demo -->
<script src="../../js/charisma.js"></script>
<script type="text/javascript" src="../../js/jquery.metadata.js"></script>
<script type="text/javascript" src="../../js/jquery.validate.min.js"></script>
<script type="text/javascript" src="../../js/messages_zh.js"></script>
<script type="text/javascript" src="../../js/qmsVld.js"></script>

<script type="text/javascript" src="../../../js/lib/date/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="../../../js/lib/date/bootstrap-datetimepicker.zh-CN.js"></script>

<script type="text/javascript">

var $qmsIp = $.qms.getCache("qmsIp");

$(function() {
	var args = {};
	args.biom = {};
	args.biom.head = {};
	args.biom.head.tradeCode = "basicconfig2select";
	args.biom.head.qmsIp = $qmsIp;
	args.biom.body = {};	
    args.command=34;	
    args.callback="basicconfig2JSCallback";
	$.icbcQms.getBasicconfig2JS(args);
	
	//查看密码，小眼睛
	$(".eye").mouseover(function(){
		$(this).attr("src","../../../images/s_eye.png");
		$(this).parent().children(":first").attr("type","text");
	});
	$(".eye").mouseleave(function(){
		$(this).attr("src","../../../images/o_eye.png");
		$(this).parent().children(":first").attr("type","password");
	});
	
	//form submit	
	$("#frm").validate({
		rules: {		
			siteId:{required:true,num:true},
			zoneNo:{required:true,num:true},
			siteName:{required:true,byteRangeLength:[0,50]},
			shutdownPwd:{required:true,checkPwdDiff:true,num:true,limitpwd:true},
			exitGetTicketPwd:{required:true,checkPwdDiff:true,num:true,limitpwd:true},
			onlineSwitchPwd:{required:true,checkPwdDiff:true,num:true,limitpwd:true},
			dutySwitchPwd:{required:true,checkPwdDiff:true,num:true,limitpwd:true},
			getShutdownTime:{checkGetTime:true},
			callShutdownTime:{checkCallTime:true},
			startonTime:{checkCallTime:true}
		},	
		onfocusout: function(element) { 
			$(element).valid(); 
		},		
		submitHandler: function(form){
			saveConfig();
			return false;
		}
	});
	$("input[name='getShutdownTime']").datetimepicker({
		format: 'hh:ii:ss',　　
		language: 'zh-CN',
		minuteStep: 1,
		maxView:0,
		autoclose: true,
		startView:1,
		todayBtn:  1,  
		todayHighlight: 1  
	});
	$("input[name='startonTime']").datetimepicker({
		format: 'hh:ii:ss',　　
		language: 'zh-CN',
		minuteStep: 1,
		maxView:0,
		autoclose: true,
		startView:1,
		todayBtn:  1,  
		todayHighlight: 1  
	});
	$("input[name='callShutdownTime']").datetimepicker({
		format: 'hh:ii:ss',　　
		language: 'zh-CN',
		minuteStep: 1,
		maxView:0,
		autoclose: true,
		startView:1,
		todayBtn:  1,  
		todayHighlight: 1  
	});	
			
	  $("input").iCheck({
	    checkboxClass: 'icheckbox_minimal-yellow',
	    radioClass: 'iradio_minimal-yellow',
	    increaseArea: '20%' // optional
	  });
	   
	  $("#getShutdownTime").change(function(){
	    var value = $(this).val();
	    if(value != ""){
	       $(this).popover("destroy");
	    }
	  });
	  
	  $("#callShutdownTime").change(function(){
	    var value = $(this).val();
	    if(value != ""){
	       $(this).popover("destroy");
	    }
	  });	 	  
	
});

$.validator.addMethod("checkGetTime", function() {
	return checkShutDownTime($("#getShutdownTime"),$("#getAutoShutdownFlag"));
},"必填字段");

$.validator.addMethod("checkCallTime", function() {
	return checkShutDownTime($("#callShutdownTime"),$("#callAutoShutdownFlag"));
},"必填字段");	

$.validator.addMethod("checkPwdDiff", function() {
	return checkPwdDiff();
},"关机密码，取号界面退出密码，联机/脱机切换，值守/非值守密码不能相同");

function checkPwdDiff(){
  	var shutdownPwd = $.trim($("#shutdownPwd").val());
  	var exitGetTicketPwd = $.trim($("#exitGetTicketPwd").val());
  	var onlineSwitchPwd = $.trim($("#onlineSwitchPwd").val());
  	var dutySwitchPwd = $.trim($("#dutySwitchPwd").val());
  	
  	var pwdArray = new Array();
    pwdArray[0] = shutdownPwd;
    pwdArray[1] = exitGetTicketPwd;
    pwdArray[2] = onlineSwitchPwd;
    pwdArray[3] = dutySwitchPwd;
    
	var nary = pwdArray.sort();
	var str = "";
	for(var i = 0; i < nary.length - 1; i++)
	{
	  if(nary[i] != "" && nary[i+1] != ""){
	   if (nary[i] == nary[i+1]){
	       str = "1";
	    }	  	
	  }
	} 	
	if(str != ""){
		return false;
	}else{
		return true;
	}
  	
}

function checkShutDownTime(obj,checkObj){
	var checkFlag = checkObj.is(':checked');
	if(checkFlag && obj.val() == ""){
		return false;
	}
	return true;
}

function saveConfig() {
	  	var siteId = $.trim($("#siteId").val());
	  	var zoneNo = $.trim($("#zoneNo").val());
	  	var siteName = $.trim($("#siteName").val());
	  	var isGetAuto = $("#getAutoShutdownFlag").is(':checked');  
	  	var isCallAuto = $("#callAutoShutdownFlag").is(':checked');
	  	var getShutdownTime = $.trim($("#getShutdownTime").val());
	  	var callShutdownTime = $.trim($("#callShutdownTime").val());
	  	var shutdownPwd = $.trim($("#shutdownPwd").val());
	  	var exitGetTicketPwd = $.trim($("#exitGetTicketPwd").val());
	  	var onlineSwitchPwd = $.trim($("#onlineSwitchPwd").val());
	  	var dutySwitchPwd = $.trim($("#dutySwitchPwd").val());
	  	var callAutoSrartonFlag = $("#callAutoSrartonFlag").is(':checked');
	  	var startonTime = $.trim($("#startonTime").val());
	  	 
		var args = {};
		args.biom = {};
		args.biom.head = {};
		args.biom.head.tradeCode = "basicconfig2update";
		args.biom.head.qmsIp = $qmsIp;
		args.biom.body = {};
		args.biom.body.siteId = siteId;
		args.biom.body.zoneNo = zoneNo;
		args.biom.body.siteName = siteName;
		if(isGetAuto){
			args.biom.body.getAutoShutdownFlag = 1;
		}else{
			args.biom.body.getAutoShutdownFlag = 0;
		}
		if(callAutoSrartonFlag){
			args.biom.body.callAutoSrartonFlag = 1;
		}else{
			args.biom.body.callAutoSrartonFlag = 0;
		}
		if(isCallAuto){
			args.biom.body.callAutoShutdownFlag = 1;
		}else{
			args.biom.body.callAutoShutdownFlag = 0;
		}
		args.biom.body.getShutdownTime = getShutdownTime;
		args.biom.body.startonTime = startonTime;
		args.biom.body.callShutdownTime = callShutdownTime;		
		args.biom.body.shutdownPwd = shutdownPwd;
		args.biom.body.exitGetTicketPwd = exitGetTicketPwd;
		args.biom.body.onlineSwitchPwd = onlineSwitchPwd;
		args.biom.body.dutySwitchPwd = dutySwitchPwd;		
        args.callback="basicconfig2updateCallBack";	
		args.command=33;
		//alert($.toJSON(args));
		$.icbcQms.getBasicconfig2JS(args);				 
}

function basicconfig2updateCallBack(args){
	//alert(args);
	var joResult = $.parseJSON(args);
	if(joResult){
		if(joResult.biom.head.retCode == 0){
			qmsVld.showInfo(joResult.biom.head.retMsg);
		}else{
			qmsVld.showError(joResult.biom.head.retMsg);
		}				
	}

}

function basicconfig2JSCallback(args){
	//alert(args);
	closeLoading();
	$("#container").css("display","block");
	var joResult = $.parseJSON(args);
	if(joResult){
		$("#siteId").val("");
	  	$("#zoneNo").val("");
	  	$("#siteName").val("");
	  	$("#getShutdownTime").val("");
	  	$("#callShutdownTime").val("");
	  	$("#shutdownPwd").val("");
	  	$("#exitGetTicketPwd").val("");
	  	$("#onlineSwitchPwd").val("");
	  	$("#dutySwitchPwd").val("");
	  	$("#startonTime").val("");
		
		var retCode = joResult.biom.head.retCode;
		var retMsg = joResult.biom.head.retMsg;
		if(retCode == "1"){
			window.location.href = "timeout.html?retMsg="+retMsg;
		}
		
	  	$("#siteId").val(joResult.biom.body.siteId);
	  	$("#zoneNo").val(joResult.biom.body.zoneNo);
	  	$("#siteName").val(joResult.biom.body.siteName);
	  	if(joResult.biom.body.getAutoShutdownFlag == "1"){
	  		$('#getAutoShutdownFlag').iCheck('check');
	  	}else{
	  		$('#getAutoShutdownFlag').iCheck('uncheck');
	  	}
	  	if(joResult.biom.body.callAutoSrartonFlag == "1"){
	  		$('#callAutoSrartonFlag').iCheck('check');
	  	}else{
	  		$('#callAutoSrartonFlag').iCheck('uncheck');
	  	}
	  	if(joResult.biom.body.callAutoShutdownFlag == "1"){
	  		$('#callAutoShutdownFlag').iCheck('check');
	  	}else{
	  		$('#callAutoShutdownFlag').iCheck('uncheck');
	  	}
	  	$("#getShutdownTime").val(joResult.biom.body.getShutdownTime);
	  	$("#callShutdownTime").val(joResult.biom.body.callShutdownTime);
	  	$("#shutdownPwd").val(joResult.biom.body.shutdownPwd);
	  	$("#exitGetTicketPwd").val(joResult.biom.body.exitGetTicketPwd);
	  	$("#onlineSwitchPwd").val(joResult.biom.body.onlineSwitchPwd);
	  	$("#dutySwitchPwd").val(joResult.biom.body.dutySwitchPwd);
	  	$("#startonTime").val(joResult.biom.body.startonTime);		
	}
}

		
</script>



</body>
</html>
